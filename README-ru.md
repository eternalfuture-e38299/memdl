# memdl - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏ üìö

## –í–≤–µ–¥–µ–Ω–∏–µ üöÄ

* memdl - —ç—Ç–æ –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞ C, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∑–∞–≥—Ä—É–∑–∫—É –æ–±—â–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (.so/.dll) –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏** –±–µ–∑ –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –¥–∏—Å–∫. –û–Ω–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API, –ø–æ–¥–æ–±–Ω—ã–π `dlopen`, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ –ø–∞–º—è—Ç–∏, –∞ –Ω–µ —Å –ø—É—Ç—è–º–∏ –∫ —Ñ–∞–π–ª–∞–º.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚ú®

- **–ò—Å—Ç–∏–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏** üîÑ - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —á–∏—Å—Ç—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ –ø–∞–º—è—Ç–∏ –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** üåç - Windows, Linux, Android, macOS, iOS
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–∫–∞—Ç–∞** üìâ - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–∏ —Å–±–æ–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞** üîí - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã ELF/Mach-O/PE

## –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º üèóÔ∏è

### ‚úÖ –ß–∏—Å—Ç–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏ (–±–µ–∑ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π)
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ | –£—Å–ª–æ–≤–∏—è |
|-----------|---------------------|---------|
| **Linux** | `memfd_create` + `/proc/self/fd` | –Ø–¥—Ä–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç memfd |
| **Android** | `memfd_create` + `android_dlopen_ext` | API ‚â• 24 (Android 7.0+) |

### üîÑ –†–µ—à–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –†–µ—à–µ–Ω–∏–µ –æ—Ç–∫–∞—Ç–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------------|----------|
| **Android (< 7.0)** | –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª + `dlopen` | –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
| **Windows** | –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª + `LoadLibrary` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Windows |
| **macOS/iOS** | –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª + `dlopen` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Apple |
| **Linux (–±–µ–∑ memfd)** | –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª + `dlopen` | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —è–¥—Ä–∞–º–∏ |

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–±–æ–µ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏ üìâ

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
```c++
// 1. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏ (–µ—Å–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
if (platform_supports_memfd) {
    handle = try_memfd_load(data, size);
    if (handle) return handle;  // ‚úÖ –£—Å–ø–µ—Ö
}

// 2. –û—Ç–∫–∞—Ç –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
handle = try_tempfile_load(data, size);  // üîÑ –†–µ–∑–µ—Ä–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
if (handle) return handle;

// 3. –í—Å–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å
return NULL;  // ‚ùå –ü–æ–ª–Ω—ã–π —Å–±–æ–π
```

### –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
```c++
memdl_handle_t handle = memdl_open(data, size, MEMDL_NOW);
if (!handle) {
    const char* error = memdl_error();
    
    if (strstr(error, "temp file")) {
        printf("‚ö†Ô∏è –°–±–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏\n");
    } else if (strstr(error, "All loading methods failed")) {
        printf("‚ùå –í—Å–µ —Ä–µ—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å: %s\n", error);
        return -1;
    }
}
```

## –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é API üìñ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```c++
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
if (memdl_validate(data, size) != 0) {
    printf("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏\n");
    return -1;
}

// –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
printf("–¢–µ–∫—É—â–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: %s\n", 
    memdl_get_platform() == MEMDL_PLATFORM_ANDROID ? "Android" : "–î—Ä—É–≥–∞—è");

// –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
int arch = memdl_get_arch(data, size);
printf("–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: %s\n", arch == MEMDL_ARCH_ARM64 ? "ARM64" : "–î—Ä—É–≥–∞—è");
```

### –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å
```c++
// 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
void* lib_data = load_library_to_memory();
size_t lib_size = get_library_size();

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ
if (memdl_validate(lib_data, lib_size) != 0) {
    printf("‚ùå –°–±–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏\n");
    return -1;
}

// 3. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è)
memdl_handle_t handle = memdl_open(lib_data, lib_size, MEMDL_NOW | MEMDL_LOCAL);
if (!handle) {
    printf("‚ùå –°–±–æ–π –∑–∞–≥—Ä—É–∑–∫–∏: %s\n", memdl_error());
    return -1;
}

// 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
void (*func)() = memdl_sym(handle, "my_function");
if (func) func();

// 5. –û—á–∏—Å—Ç–∫–∞
memdl_close(handle);
free(lib_data);
```

## –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è üîß

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Android
```c++
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏
if (memdl_get_platform() == MEMDL_PLATFORM_ANDROID) {
    char sdk_version[32];
    __system_property_get("ro.build.version.sdk", sdk_version);
    if (atoi(sdk_version) >= 24) {
        printf("‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏ Android 7.0+\n");
    } else {
        printf("‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (SDK < 24)\n");
    }
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤ (600)
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Å–∏—Å—Ç–µ–º—ã

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ üí°

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ** ‚úÖ - –í—ã–∑—ã–≤–∞–π—Ç–µ `memdl_validate()` –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
2. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ç–∫–∞—Ç–∞** ‚ö†Ô∏è - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ –∑–∞–≥—Ä—É–∑–∫–∏
3. **–°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤** üßπ - –í—ã–∑—ã–≤–∞–π—Ç–µ `memdl_close()` —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö** üîç - –ü–æ–ª—É—á–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ `memdl_error()`

## –†–µ–∑—é–º–µ üéØ

* memdl –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ –ø–∞–º—è—Ç–∏, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –Ω–µ –Ω—É–∂–Ω–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å—Å—è –æ –¥–µ—Ç–∞–ª—è—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —Ç–∞–∫ –∫–∞–∫ API –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º.